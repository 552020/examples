# QR code generator on the Internet Computer

## Overview

This example demonstrates that an Internet Computer dapp can run a long-running computation such image processing within a single message execution.
This unique feature of the blockchain is based on the technique called Deterministic Time Slicing (DTS) that automatically slices a long-running computer into smaller chunks that are executed over multiple blocks.
As this example shows, developers can write long-running code as usual and don't need anything special in order to benefit from DTS.

## Prerequisites
This example requires an installation of:

- [x] Install the [IC SDK](https://internetcomputer.org/docs/current/developer-docs/setup/install/index.mdx).
- [x] Install `node.js` to build the web frontend.
- [x] Clone this project to a local directory.

## Running locally

First make sure to start a local replica of the Internet Computer by running

```
dfx start --background
```

You can omit the `--background` argument if you want to see log messages of the dapp.

Now you can build and deploy the dapp with a single command
```
dfx deploy
```

If you see any error, it might be worthwhile to consult the [developer forum](https://forum.dfinity.org/).
If that step is successful, then you will see an output with local URLs:

```
Deployed canisters.
URLs:
  Frontend canister via browser
    qrcode_frontend: ...
  Backend canister via Candid interface:
    qrcode_backend: ...
```

Navigate to the frontend URL in your browser and you'll be able to interact with the dapp.


## How it works

The initial code of the dapp was autogenerated by `dfx` based the standard frontend/backend template.

The frontend part is an HTML page with a form that accepts user input such as the text for the QR code and various options.
When the user clicks the `Generate!` button, the JS handler of button makes a call to the backend canister.
All the heavy-lifting for making the call is done by `Candid`, `js-agent`, and `dfx` that autogenerates a JS object from the Candid interface of the backend.
The JS object has an `async` function for each of backend's endpoint.

The backend is written in Rust and it uses `qrcode-generator` and `image` crates to generate a QR code from the user text.
It also performs some image processsing to add a logo of the Internet Computer and a color gradient to the resulting image.
Depending on the image size the amount of computational work may be large.
In such a case, the execution will be automatically sliced into smaller chunks and will be carried out over multiple blocks.
This mechanism is also known as Deterministic Time Slicing (DTS).

For educational purposes, the backend exposes two public endpoint for QR code generation: an update and a query.
Currently, DTS is supported for updates, but not for queries.
As a result, the update endpoint has larger instruction limit compared to the query endpoint and thus can handle larger images.

